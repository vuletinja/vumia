<script>import { T, useThrelte, forwardEventHandlers } from '@threlte/core';
import { ShaderMaterial, Color, Vector2 } from 'three';
import { fragmentShader } from './fragment';
import { vertexShader } from './vertex';
export let opacity = 1;
export let color = '#ffffff';
export let dashOffset = 0;
export let dashArray = 0;
export let dashRatio = 0;
export let attenuate = true;
export let width = 1;
export let scaleDown = 0;
export let alphaMap = undefined;
let { invalidate, size } = useThrelte();
const material = new ShaderMaterial({
    uniforms: {
        lineWidth: { value: width },
        color: { value: new Color(color) },
        opacity: { value: opacity },
        resolution: { value: new Vector2(1, 1) },
        sizeAttenuation: { value: attenuate ? 1 : 0 },
        dashArray: { value: dashArray },
        dashOffset: { value: dashOffset },
        dashRatio: { value: dashRatio },
        useDash: { value: dashArray > 0 ? 1 : 0 },
        scaleDown: { value: scaleDown / 10 },
        alphaTest: { value: 0 },
        alphaMap: { value: alphaMap },
        useAlphaMap: { value: alphaMap ? 1 : 0 }
    }
});
$: {
    material.uniforms.resolution.value = new Vector2($size.width, $size.height);
    invalidate('Canvas size changed');
}
$: {
    material.uniforms.dashRatio.value = dashRatio;
    material.uniforms.dashArray.value = dashArray;
    material.uniforms.dashOffset.value = dashOffset;
    material.uniforms.lineWidth.value = width;
    material.uniforms.opacity.value = opacity;
    material.uniforms.color.value = new Color(color);
    invalidate('MeshLineMaterial uniforms changed');
}
const component = forwardEventHandlers();
</script>

<T
  is={material}
  bind:this={$component}
  {...$$restProps}
  {fragmentShader}
  {vertexShader}
>
  <slot ref={material} />
</T>
