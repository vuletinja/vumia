<script>import { forwardEventHandlers } from '@threlte/core';
import Instance from '../Instance.svelte';
import InnerInstancedMeshes from './InnerInstancedMeshes.svelte';
export let meshes;
const getInstance = (id) => {
    return new Proxy(Instance, {
        construct(Instance, args) {
            const opts = {
                ...args[0],
                props: {
                    ...args[0].props,
                    id
                }
            };
            return new Instance(opts);
        }
    });
};
const getInstanceComponentsArray = (meshes) => {
    return meshes.filter((mesh) => mesh.isMesh).map((mesh) => getInstance(mesh.uuid));
};
const getInstanceComponentsObject = (meshes) => {
    return Object.entries(meshes).reduce((acc, [id, mesh]) => {
        // filter out non-mesh objects
        if (!mesh.isMesh)
            return acc;
        acc[id] = getInstance(mesh.uuid);
        return acc;
    }, {});
};
$: components = Array.isArray(meshes)
    ? getInstanceComponentsArray(meshes)
    : getInstanceComponentsObject(meshes);
$: meshesArray = Array.isArray(meshes) ? meshes : Object.values(meshes);
$: filteredMeshesArray = meshesArray.filter((mesh) => mesh.isMesh);
const dispatchingComponent = forwardEventHandlers();
</script>

<InnerInstancedMeshes
  meshes={filteredMeshesArray}
  bind:this={$dispatchingComponent}
  {...$$restProps}
>
  <slot {components} />
</InnerInstancedMeshes>
